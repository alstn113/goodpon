## 테스트 최적화 전략

### 1. Spring 컨텍스트 관리

* `AbstractXxxTest`마다 **Spring 컨텍스트를 한 번만 로드**합니다.
* `AbstractXxxTest`를 상속하는 테스트 클래스들은 해당 컨텍스트를 **공유**합니다.
* 단, 테스트 내부에서 `@MockkBean` 등을 선언하면 **컨텍스트 캐싱이 무효화**되어 새로운 컨텍스트가 생성됩니다.
* 이를 방지하기 위해 다음과 같은 전략을 사용합니다:

    * 필요한 경우, `@MockkBean`은 `AbstractXxxTest` 내부에 선언합니다.
    * 또는 테스트 대상 객체에 대해 **Fake 객체**를 사용합니다.

### 2. Testcontainers 실행 최적화

* **MySQL, Redis 등 컨테이너는 전체 테스트 수행 중 1회만 실행**됩니다.
* 각 테스트 클래스 실행 후, **데이터는 삭제**되지만 `flyway_schema_history`는 유지됩니다.
* Spring 컨텍스트가 로드될 때마다 **Flyway 마이그레이션이 자동으로 실행**되며,
  기존 `flyway_schema_history` 테이블로 인해 중복 마이그레이션 없이 정상 동작합니다.

---

## 테스트 종류 및 범위

### 1. 단위 테스트

* **사용 기술**: `kotest`, `mockk`
* **테스트 대상**: `domain 계층`, `application 계층`
* 외부 의존성 없이 **비즈니스 로직만 검증**합니다.

### 2. 통합 테스트

* **사용 기술**: `SpringBootTest`, `Testcontainers`
* **테스트 대상**: `infra 계층`, `api 계층`
* 실제 인프라 의존성과 함께 **전체 흐름을 검증**합니다.
* `application` 계층은 `infra`에 대한 정보를 알지 못하므로 직접 통합 테스트를 작성할 수 없습니다.

    * 대신 `api` 모듈에서 `testFixtures`를 사용하여 필요한 정보를 참조할 수 있습니다.

### 3. 문서화 테스트

* **사용 기술**: `@WebMvcTest`, `RestDocs`, `epage`, `Swagger`
* 웹 계층의 컨트롤러 테스트를 통해 OpenAPI 스펙을 자동 생성하고 문서화합니다.

### 4. End-to-End 테스트

* 통합 테스트와 유사하나, **사용자 시나리오 기반**으로 동작을 검증합니다.
* 예시 시나리오:

    * 회원가입 → 로그인 → 인증 이메일 재전송 → 로그인 → 내 정보 조회
* 실제 환경에서 기능이 **정상적으로 동작하는지**를 검증합니다.

